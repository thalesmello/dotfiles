#!/bin/sh
OSCMD=/usr/local/bin/hs

if [[ "$1" == "os" ]]; then
  current_window=$(hs -c currentapp | grep -v 'Loading extension')
elif [[ "$1" == "tmux" ]];then
  window_bottom=$(tmux list-panes -F "#{window_height}" | head -n1)
  window_right=$(tmux list-panes -F "#{window_width}" | head -n1)
  window_bottom=$(($window_bottom - 1))
  window_right=$(($window_right - 1))
  pane=$(tmux list-panes -F "#{pane_left} #{pane_right} #{pane_top} #{pane_bottom} #{pane_active}" | grep '.* 1$')
  pane_left=$(echo "$pane" | cut -d' ' -f 1)
  pane_right=$(echo "$pane" | cut -d' ' -f 2)
  pane_top=$(echo "$pane" | cut -d' ' -f 3)
  pane_bottom=$(echo "$pane" | cut -d' ' -f 4)
fi

function os_up
{
  if [[ "$current_window" == "iTerm2" ]];
  then
    $OSCMD -c ctrl_k
  else
    $OSCMD -c focusup
  fi
}

function os_down
{
  if [[ "$current_window" == "iTerm2" ]];
  then
    $OSCMD -c ctrl_j
  else
    $OSCMD -c focusdown
  fi
}

function os_right
{
  if [[ "$current_window" == "iTerm2" ]];
  then
    $OSCMD -c ctrl_l
  else
    $OSCMD -c focusright
  fi
}

function os_left
{
  if [[ "$current_window" == "iTerm2" ]];
  then
    $OSCMD -c ctrl_h
  else
    $OSCMD -c focusleft
  fi
}

function tmux_up
{
  if [[ $pane_top  -eq 0 ]];
  then
    $OSCMD -c focusup
  else
    tmux select-pane -U
  fi
}

function tmux_down
{
  if [[ $pane_bottom  -eq $window_bottom ]];
  then
    $OSCMD -c focusdown
  else
    tmux select-pane -D
  fi
}

function tmux_right
{
  if [[ $pane_right  -eq $window_right ]];
  then
    $OSCMD -c focusright
  else
    tmux select-pane -R
  fi
}

function tmux_left
{
  if [[ $pane_left  -eq 0 ]];
  then
    $OSCMD -c focusleft
  else
    tmux select-pane -L
  fi
}


if [[ "$1" == "os" ]];then
  case "$2" in
    'up')
      os_up
      ;;
    'down')
      os_down
      ;;
    'right')
      os_right
      ;;
    'left')
      os_left
      ;;
  esac

elif [[ "$1" == "tmux" ]];then
  case "$2" in
    'up')
      tmux_up
      ;;
    'down')
      tmux_down
      ;;
    'right')
      tmux_right
      ;;
    'left')
      tmux_left
      ;;
  esac
fi
