# ################################################################ #
# THE FOLLOWING IS AN EXPLANATION OF THE GRAMMAR THAT SKHD PARSES. #
# FOR SIMPLE EXAMPLE MAPPINGS LOOK FURTHER DOWN THIS FILE..        #
# ################################################################ #

# A list of all built-in modifier and literal keywords can
# be found at https://github.com/koekeishiya/skhd/issues/1
#
# A hotkey is written according to the following rules:
#
#   hotkey       = <mode> '<' <action> | <action>
#
#   mode         = 'name of mode' | <mode> ',' <mode>
#
#   action       = <keysym> '[' <proc_map_lst> ']' | <keysym> '->' '[' <proc_map_lst> ']'
#                  <keysym> ':' <command>          | <keysym> '->' ':' <command>
#                  <keysym> ';' <mode>             | <keysym> '->' ';' <mode>
#
#   keysym       = <mod> '-' <key> | <key>
#
#   mod          = 'modifier keyword' | <mod> '+' <mod>
#
#   key          = <literal> | <keycode>
#
#   literal      = 'single letter or built-in keyword'
#
#   keycode      = 'apple keyboard kVK_<Key> values (0x3C)'
#
#   proc_map_lst = * <proc_map>
#
#   proc_map     = <string> ':' <command> | <string>     '~' |
#                  '*'      ':' <command> | '*'          '~'
#
#   string       = '"' 'sequence of characters' '"'
#
#   command      = command is executed through '$SHELL -c' and
#                  follows valid shell syntax. if the $SHELL environment
#                  variable is not set, it will default to '/bin/bash'.
#                  when bash is used, the ';' delimeter can be specified
#                  to chain commands.
#
#                  to allow a command to extend into multiple lines,
#                  prepend '\' at the end of the previous line.
#
#                  an EOL character signifies the end of the bind.
#
#   ->           = keypress is not consumed by skhd
#
#   *            = matches every application not specified in <proc_map_lst>
#
#   ~            = application is unbound and keypress is forwarded per usual, when specified in a <proc_map>
#
# A mode is declared according to the following rules:
#
#   mode_decl = '::' <name> '@' ':' <command> | '::' <name> ':' <command> |
#               '::' <name> '@'               | '::' <name>
#
#   name      = desired name for this mode,
#
#   @         = capture keypresses regardless of being bound to an action
#
#   command   = command is executed through '$SHELL -c' and
#               follows valid shell syntax. if the $SHELL environment
#               variable is not set, it will default to '/bin/bash'.
#               when bash is used, the ';' delimeter can be specified
#               to chain commands.
#
#               to allow a command to extend into multiple lines,
#               prepend '\' at the end of the previous line.
#
#               an EOL character signifies the end of the bind.

# ############################################################### #
# THE FOLLOWING SECTION CONTAIN SIMPLE MAPPINGS DEMONSTRATING HOW #
# TO INTERACT WITH THE YABAI WM. THESE ARE SUPPOSED TO BE USED AS #
# A REFERENCE ONLY, WHEN MAKING YOUR OWN CONFIGURATION..          #
# ############################################################### #


ctrl + alt + cmd + shift - 0x29 : skhd-preset search-and-execute-command # semicolon
ctrl + alt + cmd + shift - m : wm-preset deminimize-last
ctrl + alt + cmd - m : wm-preset minimize
ctrl + alt + cmd - return : wm-preset smart-toggle-fullscreen

ctrl + alt + cmd + shift - return : wm-preset unstacked-swap-largest

service < ctrl + alt + cmd - v : skhd -k "escape"; btt-preset send-keys cmd c; and pbneovide --guess
ctrl + alt + cmd - v : btt-preset alternate-app "Neovide" --hide --cmd "neovim-ghost trigger"

# For some reason, the script if very slow. I need to investigate some other time.
# ctrl + alt + cmd - t : btt-preset trigger-named-trigger "Chrome: Open New Tab (with selection is One Line)"
ctrl + alt + cmd - t : btt-preset trigger-named-trigger "Chrome: New Tab and Focus"

ctrl + alt + cmd - 0x21 : wm-preset focus-space prev # Open square bracket [
ctrl + alt + cmd - 0x1E : wm-preset focus-space next # Close square bracket ]

ctrl + alt + cmd - h : wm-preset focus-window west
ctrl + alt + cmd - j : wm-preset focus-window south
ctrl + alt + cmd - k : wm-preset focus-window north
ctrl + alt + cmd - l : wm-preset focus-window east

ctrl + alt + cmd + shift - h : wm-preset swap-window west
ctrl + alt + cmd + shift - j : wm-preset swap-window south
ctrl + alt + cmd + shift - k : wm-preset swap-window north
ctrl + alt + cmd + shift - l : wm-preset swap-window east

ctrl + alt + cmd - 0x1B : wm-preset resize smart -100 # minus
ctrl + alt + cmd - 0x18 : wm-preset resize smart +100 # equals

ctrl + alt + cmd - 1 : yabai-harpoon focus 1
ctrl + alt + cmd - 2 : yabai-harpoon focus 2
ctrl + alt + cmd - 3 : yabai-harpoon focus 3
ctrl + alt + cmd - 4 : yabai-harpoon focus 4
ctrl + alt + cmd - 5 : yabai-harpoon focus 5
ctrl + alt + cmd - 6 : yabai-harpoon focus 6
ctrl + alt + cmd - 7 : yabai-harpoon focus 7
ctrl + alt + cmd - 8 : yabai-harpoon focus 8
ctrl + alt + cmd - 9 : yabai-harpoon focus 9


ctrl + alt + cmd + shift - 0x18 : skhd -k "escape"; yabai-harpoon add # equals
service < a : skhd -k "escape"; yabai-harpoon add
service < backspace : skhd -k "escape"; yabai-harpoon delete
service < e : skhd -k "escape"; yabai-harpoon edit

ctrl + alt + cmd - n :   wm-preset focus-window-in-stack next || wm-preset focus-window-in-space next
ctrl + alt + cmd - p :   wm-preset focus-window-in-stack prev || wm-preset focus-window-in-space prev
ctrl + alt + cmd + shift - n : wm-preset move-window-in-stack next
ctrl + alt + cmd + shift - p : wm-preset move-window-in-stack prev

resize < return ; default
resize < j : wm-preset resize height +100
resize < k : wm-preset resize height -100
resize < h : wm-preset resize width -100
resize < l : wm-preset resize width +100
resize < shift - j : wm-preset resize height +100
resize < shift - k : wm-preset resize height -100
resize < shift - h : wm-preset resize width -100
resize < shift - l : wm-preset resize width +100
resize < shift - 0x2B : wm-preset rotate 90 # comma
resize < shift - 0x2F : wm-preset rotate 270 # period



ctrl + alt + cmd - space ; service

# If PID file exists and has a running process, focus window instead of creating a new one
service < ctrl + alt + cmd - e : skhd -k "escape"; if pgrep -q -F "$TMPDIR/nvim_skhd.pid"; \
        display-message "Focus SKHD"; \
        neovim-ghost focus-or-new-tab "$HOME/.skhdrc_main"; \
    else; \
        display-message "Edit SKHD"; \
        fish -c "neovim-ghost edit '$HOME/.skhdrc_main'" &; \
        echo "$last_pid" > "$TMPDIR/nvim_skhd.pid"; \
        wait; \
        rm "$TMPDIR/nvim_skhd.pid"; \
    end;

# Service mode bindings
service < ctrl + alt + cmd - space : skhd -k "escape"; wm-preset focus-space recent
service < space : skhd -k "escape"; wm-preset focus-back-and-forth
service < shift - space : skhd -k "escape"; wm-preset move-window-to-space recent
service < r ; resize
service < ctrl + alt + cmd - r ; restart
restart < ctrl + alt + cmd - y : skhd -k "escape"; wm-preset restart-wm
restart < ctrl + alt + cmd - b : skhd -k "escape";  display-message "Restart BTT" && btt-preset restart-btt
restart < ctrl + alt + cmd - a : skhd -k "escape";  display-message "Restart Alfred" && killall Alfred; sleep 2 && open -a "Alfred 5"
restart < ctrl + alt + cmd - m : skhd -k "escape";  display-message "Restart Mouseless" && killall mouseless; sleep 2 && open -a "Mouseless"
restart < ctrl + alt + cmd - v : skhd -k "escape";  display-message "Restart NVIM Ghost" && neovim-ghost kill; sleep 2 && neovim-ghost start
restart < ctrl + alt + cmd - k : skhd -k "escape";  display-message "Restart Karabiner" && launchctl kickstart -k gui/$(id -u)/org.pqrs.service.agent.karabiner_console_user_server
restart < ctrl + alt + cmd - s : skhd -k "escape"; if pgrep -xq AeroSpace; display-message "Killing AeroSpace" && killall AeroSpace; else; yabai-preset layout-float-all; display-message "Starting AeroSpace" && open -a AeroSpace; end
service < shift - y : skhd -k "escape"; wm-preset toggle-wm
service < v : skhd -k "escape"; wm-preset insert-direction east
service < shift - 0x27 : skhd -k "escape"; wm-preset insert-direction south # double quotes
# Temporaily disable window restore to debug later
# service < t : skhd -k "escape"; wm-preset toggle-float
service < t : skhd -k "escape"; wm-preset toggle-float

service < z : skhd -k "escape"; wm-preset insert-direction stack # comma
service < s : skhd -k "escape"; wm-preset insert-direction stack
service < shift - s : skhd -k "escape"; wm-preset stack-windows-in-space
service < m : skhd -k "escape"; wm-preset minimize-after-nth-window 3 # Period
service < shift - m : skhd -k "escape"; wm-preset deminimize-all
service < 0x2B : skhd -k "escape"; wm-preset layout-stack # Comma
service < shift - 0x2B : skhd -k "escape"; wm-preset layout-bsp; wm-preset stack-windows-in-space # Comma
service < shift - 0x2F : skhd -k "escape"; wm-preset layout-bsp; wm-preset minimize-after-nth-window 3 # Period
service < shift - t : skhd -k "escape"; wm-preset layout-float
service < 0x2F : skhd -k "escape"; wm-preset layout-bsp
service < 0 : skhd -k "escape"; wm-preset flatten

service < shift - 0x2A : skhd -k "escape"; wm-preset mirror y-axis # Pipe |
service < 0x1B : skhd -k "escape"; wm-preset mirror x-axis # minus
service < shift - 5 : skhd -k "escape"; wm-preset mirror x-axis; wm-preset mirror y-axis # percent
service < y : skhd -k "escape"; wm-preset toggle-split
service < 0x18 : skhd -k "escape"; wm-preset balance # equals
# move window to space with number
service < 1 : skhd -k "escape"; wm-preset focus-space 1
service < 2 : skhd -k "escape"; wm-preset focus-space 2
service < 3 : skhd -k "escape"; wm-preset focus-space 3
service < 4 : skhd -k "escape"; wm-preset focus-space 4
service < 5 : skhd -k "escape"; wm-preset focus-space 5
service < 6 : skhd -k "escape"; wm-preset focus-space 6
service < 7 : skhd -k "escape"; wm-preset focus-space 7
service < 8 : skhd -k "escape"; wm-preset focus-space 8
service < 9 : skhd -k "escape"; wm-preset focus-space 9
service < shift - 1 : skhd -k "escape"; wm-preset move-window-to-space 1
service < shift - 2 : skhd -k "escape"; wm-preset move-window-to-space 2
service < shift - 3 : skhd -k "escape"; wm-preset move-window-to-space 3
service < shift - 4 : skhd -k "escape"; wm-preset move-window-to-space 4
service < shift - 5 : skhd -k "escape"; wm-preset move-window-to-space 5
service < shift - 6 : skhd -k "escape"; wm-preset move-window-to-space 6
service < shift - 7 : skhd -k "escape"; wm-preset move-window-to-space 7
service < shift - 8 : skhd -k "escape"; wm-preset move-window-to-space 8
service < shift - 9 : skhd -k "escape"; wm-preset move-window-to-space 9
service < ctrl + alt + cmd - h : skhd -k "escape"; wm-preset warp-window west
service < ctrl + alt + cmd - j : skhd -k "escape"; wm-preset warp-window south
service < ctrl + alt + cmd - k : skhd -k "escape"; wm-preset warp-window north
service < ctrl + alt + cmd - l : skhd -k "escape"; wm-preset warp-window east
service < h : skhd -k "escape"; wm-preset focus-display-with-fallback west
service < j : skhd -k "escape"; wm-preset focus-display-with-fallback south
service < k : skhd -k "escape"; wm-preset focus-display-with-fallback north
service < l : skhd -k "escape"; wm-preset focus-display-with-fallback east
service < tab : skhd -k "escape"; wm-preset smart-move-window-to-next-display
service < shift - 0x2C : skhd -k "escape"; btt-preset trigger-menu-bar 'Help' # slash / question mark
service < ctrl + alt + cmd - 0x2C : skhd -k "escape"; skhd-preset search-and-display-mapping # slash / question mark

service < shift - v : skhd -k "escape"; btt-preset trigger-menu-bar 'Window;Full Screen Tile; Left of Screen'
service < ctrl + alt + cmd - return : skhd -k "escape" ; btt-preset send-keys ctrl cmd f


# Below is a list of keybinidng that would be equivalent to "Invoke" move on Aerospace
# But currently there's no support for presetting windows in a specific space without disabling SIP
# I'm keeping this commented in case it's useful in the future
# Invoke mode bindings
ctrl + alt + cmd - i ; invoke
invoke < 1 : skhd -k "escape"; wm-preset arrange-spaces \
    -w "1:.*Thales \\(Work\\).*" \
    -a "2:iTerm2" \
    -a "3:.*VS Code.*" \
    -a "4:Workchat" \
    -a "5:Obsidian"
invoke < p : skhd -k "escape"; wm-preset arrange-spaces \
    -w "7:.*Thales \\(Personal\\).*"
invoke < b : skhd -k "escape"; osascript -e 'tell application "Alfred" to search "btt "'
invoke < t : skhd -k "escape"; osascript -e 'tell application "Alfred" to search "top "'
invoke < y : skhd -k "escape"; open 'raycast://extensions/tonka3000/youtube/search-videos?arguments=%7B%22query%22%3A%22%22%7D'
invoke < return : skhd -k "escape"; iterm-preset new-window
invoke < ctrl + alt + cmd - i : skhd -k "escape"; display-message "AI Input Mode"; osascript -e "set volume input volume 100"; set-preferred-input-device
invoke < ctrl + alt + cmd - r : skhd -k "escape"; display-message "Reinitialize Displays"; betterdisplaycli perform --reinitialize


service < c ; chrome
ctrl + alt + cmd - 0x27 ; chrome # single quote
chrome < ctrl + alt + cmd - 0x27 ; goto # single quote
chrome < 0x27 ; goto # single quote
chrome < backspace : skhd -k "escape"; chrome-preset close-tabs-with-url '^.*\.zoom\.us/j/.*$'
chrome < 1 : skhd -k "escape"; chrome-preset focus-pinned-tab 1
chrome < 2 : skhd -k "escape"; chrome-preset focus-pinned-tab 2
chrome < 3 : skhd -k "escape"; chrome-preset focus-pinned-tab 3
chrome < 4 : skhd -k "escape"; chrome-preset focus-pinned-tab 4
chrome < 5 : skhd -k "escape"; chrome-preset focus-pinned-tab 5
chrome < 6 : skhd -k "escape"; chrome-preset focus-pinned-tab 6
chrome < 7 : skhd -k "escape"; chrome-preset focus-pinned-tab 7
chrome < 8 : skhd -k "escape"; chrome-preset focus-pinned-tab 8
chrome < 9 : skhd -k "escape"; chrome-preset focus-pinned-tab 9
chrome < shift - 1 : skhd -k "escape"; chrome-preset pin-tab 1
chrome < shift - 2 : skhd -k "escape"; chrome-preset pin-tab 2
chrome < shift - 3 : skhd -k "escape"; chrome-preset pin-tab 3
chrome < shift - 4 : skhd -k "escape"; chrome-preset pin-tab 4
chrome < shift - 5 : skhd -k "escape"; chrome-preset pin-tab 5
chrome < shift - 6 : skhd -k "escape"; chrome-preset pin-tab 6
chrome < shift - 7 : skhd -k "escape"; chrome-preset pin-tab 7
chrome < shift - 8 : skhd -k "escape"; chrome-preset pin-tab 8
chrome < shift - 9 : skhd -k "escape"; chrome-preset pin-tab 9

#chrome_start
chrome < y : skhd -k "escape"; chrome-preset focus-or-open-url --profile="Default" youtube.com
chrome < g : skhd -k "escape"; chrome-preset focus-or-open-url --profile="Default" gmail.com
#chrome_end

# Cmd to sync Chrome and goto links
# :/^#chrome_start/+1,/^#chrome_end/yank a | /^#goto_start/+1,/^#goto_end/delete | /^#goto_start/put a | '[,']s/chrome/goto/ | '[,']s/focus-or-open-url/open-url/e

#goto_start
goto < y : skhd -k "escape"; chrome-preset open-url --profile="Default" youtube.com
goto < g : skhd -k "escape"; chrome-preset open-url --profile="Default" gmail.com
#goto_end

# App Shortcuts
ctrl + alt + cmd - b : btt-preset show-or-hide-app --only-show "/Applications/BetterTouchTool.app"
ctrl + alt + cmd - c : btt-preset show-or-hide-app --only-show "/Applications/Cursor.app"

ctrl + alt + cmd - x : btt-preset show-or-hide-app --only-show "/Applications/iTerm.app"; and iterm-preset is-floating-window-active; and skhd -k "cmd - 0x32"; and echo hi # backtick
ctrl + alt + cmd - q : chrome-preset focus-or-open-url "gemini.google.com" --label "Gemini"
ctrl + alt + cmd - w : btt-preset show-or-hide-app --only-show "/Applications/WhatsApp.app"
ctrl + alt + cmd - z : btt-preset show-or-hide-app --only-show "/Applications/Obsidian.app"
ctrl + alt + cmd - s : btt-preset alternate-app "YouTube Music" --hide
ctrl + alt + cmd - e : btt-preset show-or-hide-app --only-show "/Applications/Google Chrome.app"
ctrl + alt + cmd - r : btt-preset show-or-hide-app --only-show "/Applications/Google Chrome.app"
ctrl + alt + cmd - a : btt-preset show-or-hide-app --only-show "/Applications/Timery.app"
ctrl + alt + cmd + shift - a : btt-preset show-or-hide-app --only-show "~/Applications/Chrome Apps.localized/Pomofocus.app"
ctrl + alt + cmd + shift - z : btt-preset show-or-hide-app --only-show "~/Applications/Chrome Apps.localized/Google Keep.app"
ctrl + alt + cmd + shift - w : if pgrep "zoom.us" >/dev/null; \
        btt-preset show-or-hide-app --only-show "/Applications/zoom.us.app"; \
    else; \
        chrome-preset focus-or-open-url meet.google.com --label "Google Meet"; \
    end;
ctrl + alt + cmd + shift - s : if pgrep "zoom.us" >/dev/null; \
        display-message "Toggle Mute"; \
        btt-preset show-or-hide-app --only-show "/Applications/zoom.us.app"; \
        sleep 0.5; \
        btt-preset send-keys cmd shift a; \
    else; \
        display-message "Toggle Mute"; \
        chrome-preset focus-or-open-url meet.google.com --label "Google Meet"; \
        sleep 0.5; \
        btt-preset send-keys cmd d; \
    end;
ctrl + alt + cmd + shift - f : btt-preset show-or-hide-app --only-show "/Applications/WhatsApp.app"
ctrl + alt + cmd + shift - g : btt-preset show-or-hide-app --only-show "/System/Applications/Messages.app"
ctrl + alt + cmd + shift - q : btt-preset show-or-hide-app --only-show "/System/Applications/Utilities/Activity Monitor.app"

ctrl + alt + cmd - y : chrome-preset focus-or-open-url calendar.google.com --label "Calendar"

ctrl + alt + cmd - u : workflow-preset perform-default-ui

ctrl + alt + cmd - o [
    "iTerm2" : ua --clipboard
    * : ua
]
ctrl + alt + cmd + shift - o : ua

ctrl + alt + cmd + shift - v : if pgrep "kindaVim" >/dev/null; \
        display-message "Exit kindaVim"; \
        killall "kindaVim"; \
    else; \
        display-message "Enter kindaVim"; \
        open -a "kindaVim"; \
    end;
